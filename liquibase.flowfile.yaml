# Minimal Flow: snapshot → update → diff.
# Values are injected via env: DB_URL, CONTEXTS, SNAPSHOT, DIFF, LB_USER, LB_PASSWORD.

stages:
  deploy:
    actions:
      - type: liquibase
        command: snapshot
        cmdArgs:
          url: "${DB_URL}"
          username: "${LB_USER}"
          password: "${LB_PASSWORD}"
          snapshot-format: "JSON"
          output-file: "${SNAPSHOT}"

      - type: liquibase
        command: update
        cmdArgs:
          changelog-file: "changelog/master.xml"
          url: "${DB_URL}"
          username: "${LB_USER}"
          password: "${LB_PASSWORD}"
          contexts: "${CONTEXTS}"

      - type: liquibase
        command: diff
        cmdArgs:
          reference-snapshot: "${SNAPSHOT}"
          url: "${DB_URL}"
          username: "${LB_USER}"
          password: "${LB_PASSWORD}"
          output-file: "${DIFF}"

flows:
  # policies → snapshot → update → diff(dev→test)
  policies-snapshot-update-diff:
    env:
      CHANGELOG: changelog/master.xml
    steps:
      - liquibase:
          command: checks run
          args:
            changeLogFile: ${CHANGELOG}
            url: ${LB_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
      - liquibase:
          command: snapshot
          args:
            url: ${LB_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
      - liquibase:
          command: update
          args:
            changeLogFile: ${CHANGELOG}
            url: ${LB_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
      - liquibase:
          command: diff
          args:
            referenceUrl: ${DEV_URL}
            referenceUsername: ${LB_USER}
            referencePassword: ${LB_PWD}
            url: ${TEST_URL}
            username: ${LB_USER}
            password: ${LB_PWD}

  # policies → update → diff (no snapshot)
  policies-update-diff:
    env:
      CHANGELOG: changelog/master.xml
    steps:
      - liquibase:
          command: checks run
          args:
            changeLogFile: ${CHANGELOG}
            url: ${LB_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
      - liquibase:
          command: update
          args:
            changeLogFile: ${CHANGELOG}
            url: ${LB_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
      - liquibase:
          command: diff
          args:
            referenceUrl: ${DEV_URL}
            referenceUsername: ${LB_USER}
            referencePassword: ${LB_PWD}
            url: ${TEST_URL}
            username: ${LB_USER}
            password: ${LB_PWD}

  # snapshot → update → diff (no policies)
  snapshot-update-diff:
    env:
      CHANGELOG: changelog/master.xml
    steps:
      - liquibase:
          command: snapshot
          args:
            url: ${LB_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
      - liquibase:
          command: update
          args:
            changeLogFile: ${CHANGELOG}
            url: ${LB_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
      - liquibase:
          command: diff
          args:
            referenceUrl: ${DEV_URL}
            referenceUsername: ${LB_USER}
            referencePassword: ${LB_PWD}
            url: ${TEST_URL}
            username: ${LB_USER}
            password: ${LB_PWD}

  # update → diff (no policies, no snapshot)
  update-diff:
    env:
      CHANGELOG: changelog/master.xml
    steps:
      - liquibase:
          command: update
          args:
            changeLogFile: ${CHANGELOG}
            url: ${LB_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
      - liquibase:
          command: diff
          args:
            referenceUrl: ${DEV_URL}
            referenceUsername: ${LB_USER}
            referencePassword: ${LB_PWD}
            url: ${TEST_URL}
            username: ${LB_USER}
            password: ${LB_PWD}
